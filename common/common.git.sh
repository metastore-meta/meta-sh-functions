# -------------------------------------------------------------------------------------------------------------------- #
# Ext: Timestamp.
# -------------------------------------------------------------------------------------------------------------------- #
function ext.timestamp() {
	timestamp="$( date -u '+%Y-%m-%d %T' )"

	echo ${timestamp}
}

# -------------------------------------------------------------------------------------------------------------------- #
# Ext: Version.
# -------------------------------------------------------------------------------------------------------------------- #

function ext.build.version() {
	version="$( date -u '+%Y%m%d%H%M%S' )"

	echo ${version}
}

# -------------------------------------------------------------------------------------------------------------------- #
# Git: Push.
# -------------------------------------------------------------------------------------------------------------------- #

function git.push() {
	name="$( basename ${PWD} )"
	timestamp="$( ext.timestamp )"
	commit="$*"

	echo ""
	echo "--- Pushing ${name}"

	git add . && git commit -a -m "${timestamp}" -m "${commit}" && git push

	echo "--- Finished ${name}"
	echo ""
}

# -------------------------------------------------------------------------------------------------------------------- #
# Git: Push all.
# -------------------------------------------------------------------------------------------------------------------- #

function git.push.all() {
	for i in `ls`; do
		if [ -d ${i}/.git ]; then
			cd ${i}
			git.push
			cd ..
		fi
	done
}

# -------------------------------------------------------------------------------------------------------------------- #
# Git: Push version.
# -------------------------------------------------------------------------------------------------------------------- #

function git.push.version() {
	tag_list=$( git tag --list )

	if [[ -z "${1}" ]]; then
		if [[ -z "${tag_list}" ]]; then
			version="1.0.0"
		else
			tag=( $( git describe --abbrev=0 --tags | tr '.' ' ' ) )
			major=${tag[1]}
			minor=${tag[2]}
			patch=${tag[3]}
			version="${major}.${minor}.$(( ${patch} + 1 ))"
		fi
	else
		version="${1}"
	fi

	git.push && git tag -a ${version} -m "Version ${version}" && git push origin ${version}
}

# -------------------------------------------------------------------------------------------------------------------- #
# Git: Push page.
# -------------------------------------------------------------------------------------------------------------------- #

function git.push.page() {
	if [[ -z "${1}" ]]; then
		branch="page-stable"
	else
		branch="${1}"
	fi

	git.push && git checkout master && git merge ${branch} && git push && git checkout ${branch}
}
